<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TechFix — Connect</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
  --neon:#00ffff;
  --bg:#020611;
  --card:rgba(0,0,0,0.65);
  --accent:linear-gradient(90deg,#00ffff,#8a2be2);
}
html,body{height:100%;background:var(--bg);color:var(--neon);font-family:'Play',system-ui,sans-serif;}
a{color:var(--neon);text-decoration:none}
.navbar{background:transparent;border-bottom:1px solid rgba(0,255,255,0.1);backdrop-filter:blur(4px)}
.container-card{max-width:1100px;margin-top:6.5rem;margin-bottom:4rem}
.card-panel{background:var(--card);border:1px solid rgba(0,255,255,0.08);border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);overflow:hidden}
.left-qr{display:flex;align-items:center;justify-content:center;padding:2rem;background:linear-gradient(180deg,rgba(0,255,255,0.02),rgba(138,43,226,0.02));border-right:1px solid rgba(0,255,255,0.03);}
.qr-box{width:260px;height:260px;border-radius:10px;border:2px solid rgba(0,255,255,0.4);display:flex;align-items:center;justify-content:center;flex-direction:column;background:rgba(0,0,0,0.25);}
.right-form{padding:2rem 2.25rem}
.nav-tabs .nav-link{color:var(--neon);border:none;border-bottom:2px solid transparent}
.nav-tabs .nav-link.active{border-bottom:2px solid var(--neon)}
.form-control{background:transparent;border:1px solid rgba(0,255,255,0.15);color:var(--neon);border-radius:8px;}
.form-control::placeholder{color:rgba(143,252,255,0.45)}
.btn-connect{background:var(--accent);color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;box-shadow:0 6px 20px rgba(0,255,255,0.12)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--neon)}
.small-muted{color:rgba(143,252,255,0.6);font-size:.9rem}
.badge-status{background:rgba(0,255,255,0.08);color:var(--neon);padding:.35rem .6rem;border-radius:999px;font-weight:600}
.spinner-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1100;backdrop-filter:blur(3px)}
.modal-sim{background:var(--card);padding:1.25rem 2rem;border-radius:12px;border:1px solid rgba(0,255,255,0.06);text-align:center}
@media(max-width:991px){.left-qr{display:none}.container-card{margin-top:4.5rem}}
</style>
</head>
<body>
<nav class="navbar fixed-top">
  <div class="container">
    <a class="fw-bold" href="index.html" style="color:var(--neon);font-size:1.25rem;">TechFix</a>
    <a href="index.html" class="small-muted">Back to Home</a>
  </div>
</nav>

<div class="container container-card">
  <div class="card-panel d-flex">
    <!-- Left QR -->
    <div class="left-qr">
      <div class="qr-box text-center">
        <div id="qrcode"></div>
        <button class="btn btn-ghost btn-sm mt-3" onclick="generateQR()">Refresh QR</button>
        <div class="small-muted mt-2" id="qrLinkText"></div>
      </div>
    </div>

    <!-- Right form -->
    <div class="right-form flex-grow-1">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <h4>Connect your account</h4>
        <div class="badge-status">Gateway: Online</div>
      </div>

      <ul class="nav nav-tabs" id="tabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pw">Password</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#token">Token</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#qr">QR</button></li>
      </ul>

      <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="pw">
          <input id="userPw" class="form-control mb-3" placeholder="Username">
          <input id="passPw" type="password" class="form-control mb-3" placeholder="Password">
          <button class="btn btn-connect w-100" onclick="connect('password')">Connect</button>
        </div>
        <div class="tab-pane fade" id="token">
          <input id="tokenInput" class="form-control mb-3" placeholder="API Token">
          <input id="deviceName" class="form-control mb-3" placeholder="Device name (optional)">
          <button class="btn btn-connect w-100" onclick="connect('token')">Connect</button>
        </div>
        <div class="tab-pane fade" id="qr">
          <input id="userQr" class="form-control mb-3" placeholder="Associated username">
          <button class="btn btn-connect w-100" onclick="connect('qr')">Finish</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loader -->
<div id="spinner" class="spinner-overlay" style="display:none">
  <div class="modal-sim">
    <h5>Connecting...</h5>
    <div class="spinner-border text-info mt-3" style="width:2.5rem;height:2.5rem"></div>
    <p class="small-muted mt-3">Authenticating your session...</p>
  </div>
</div>

<!-- Success modal -->
<div id="successModal" class="spinner-overlay" style="display:none">
  <div class="modal-sim">
    <h5>✅ Connection Successful</h5>
    <p class="mt-2 small-muted" id="successText"></p>
  </div>
</div>

<!-- QR library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function showSpinner(v){document.getElementById('spinner').style.display=v?'flex':'none';}
function showSuccess(user,method){
  const modal=document.getElementById('successModal');
  document.getElementById('successText').textContent=`Welcome ${user}! Connected via ${method.toUpperCase()}. Redirecting...`;
  modal.style.display='flex';
  setTimeout(()=>{modal.style.display='none';window.location='dashboard.html';},1600);
}

function connect(method){
  let user='';
  if(method==='password') user=document.getElementById('userPw').value.trim();
  if(method==='token') user=document.getElementById('deviceName').value.trim()||'token_user';
  if(method==='qr') user=document.getElementById('userQr').value.trim()||'qr_user';
  if(!user){alert('Please enter a username.');return;}
  localStorage.setItem('techfixUser',user);
  localStorage.setItem('techfixMethod',method);
  showSpinner(true);
  setTimeout(()=>{showSpinner(false);showSuccess(user,method);},1200);
}

// --- QR generation ---
let qr;
function generateQR(){
  const sessionId='session-'+Date.now();
  const link=`https://techfix.app/connect?session=${sessionId}`;
  const qrBox=document.getElementById('qrcode');
  qrBox.innerHTML='';
  qr=new QRCode(qrBox,{text:link,width:220,height:220,colorDark:"#00ffff",colorLight:"#000",correctLevel:QRCode.CorrectLevel.H});
  const qrText=document.getElementById('qrLinkText');
  qrText.innerHTML=`<a href="${link}" target="_blank">${link}</a>`;
}
generateQR();
</script>
</body>
</html>
